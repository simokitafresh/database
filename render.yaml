services:
  - type: web
    name: stockdata-api  # stock-apiから変更
    env: docker
    plan: starter
    autoDeploy: true
    healthCheckPath: /healthz
    startCommand: ./docker/entrypoint.sh
    buildCommand: pip install --upgrade pip && pip install --no-cache-dir -r requirements.txt
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: ALEMBIC_DATABASE_URL
        sync: false
      - key: DB_POOL_SIZE
        value: "2"  # 3から2に変更
      - key: DB_MAX_OVERFLOW
        value: "3"  # 2から3に変更
      - key: DB_POOL_RECYCLE
        value: "900"  # 1800から900に変更
      - key: GUNICORN_TIMEOUT
        value: "60"  # 180から60に変更
      - key: FETCH_TIMEOUT_SECONDS
        value: "30"  # 新規追加
      - key: REQUEST_TIMEOUT_SECONDS
        value: "45"  # 新規追加
      - key: YF_REQ_CONCURRENCY
        value: "2"  # 4から2に変更
      - key: WEB_CONCURRENCY
        value: "2"
      - key: API_MAX_SYMBOLS
        value: "50"
      - key: API_MAX_ROWS
        value: "1000000"
      - key: PYTHON_VERSION
        value: "3.12"
